
etcdir = /etc
initddir = $(etcdir)/init.d
INSTALL = /usr/bin/install -c

all: 
install: install_initd
uninstall: uninstall_initd

install_initd: 
	if [ -f /etc/debian_version ]; then \
                $(MAKE) install_initd_debian ; \
        elif [ -f /etc/redhat-release ]; then \
                $(MAKE) install_initd_redhat ; \
        fi

install_initd_redhat:
	test -z "$(initddir)" || /bin/mkdir -p "$(DESTDIR)$(initddir)"	
	$(INSTALL) -m 755 init.d/initd.redhat \
                $(DESTDIR)$(initddir)/zfsload
	/sbin/chkconfig --add zfsload
	service zfsload start


install_initd_debian:
	test -z "$(initddir)" || /bin/mkdir -p "$(DESTDIR)$(initddir)"	
	$(INSTALL) -m 755 init.d/initd.debian \
                $(DESTDIR)$(initddir)/zfsload
	/usr/sbin/update-rc.d zfsload defaults
	service zfsload start

uninstall_initd:
	if [ -f /etc/debian_version ]; then \
                $(MAKE) uninstall_initd_debian ; \
	elif [ -f /etc/redhat-release ]; then \
                $(MAKE) uninstall_initd_redhat ; \
	fi

uninstall_initd_redhat:
	service zfsload stop 
	/sbin/chkconfig --del  zfsload 

uninstall_initd_debian:
	service zfsload stop 
	/usr/sbin/update-rc.d -f zfsload remove 

clean:

distclean:

check:

distdir: 
	find ./ | xargs /bin/cp -rt $$distdir/$$subdir;
